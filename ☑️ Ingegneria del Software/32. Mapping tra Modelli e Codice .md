# 32 Mapping tra Modelli e Codice

Tradurre i disegni in codice vero e proprio.

## Panoramica e Concetti generali

traformare il modello uml in codice è un attivita strategica per garantire che il software sia mantenibile ed evolvibile.

4 Concetti Fondamentali:
1. __Model transformation__ -> modifichi il diagramma UML prima di scrivere il codice.
2. __Refactoring__ -> modifichi il codice senza cambiare comportamento per pulirlo.
3. __Forward Engineering__ -> generi il codice partendo dal modello
4. __Reverse Engeneering__ -> percorso inverso: parti dal codice per derivare il modello.

Regole d'oro:
1. un obiettivo per volta
2. locale: modifica di soli pochi elementi per volta non tutti il sistema insieme.
3. isolata: non mischiare modifiche
4. validita: dopo ogni modifica bisogna testare che tutto funzioni ancora

## Ottimizzazione del modello

in breve descrive tecniche per affrontare problemi in maniera efficiente:
- variabili rindondanti
- mappe vs liste
- non over creare classi per tutto: se un elemento ha solo attributi e non metodi conviene trasformarlo in attributo della classe padre.
- __Proxy Pattern__: caricamento leggero di un oggetto che rappresenta quello reale che è piu pesante e caricarlo solo quando necessario.
- Caching: se possibile utilizzare la cache per operazioni ripetitive

## Associazioni

- 1:1
    - A->B unidirezionale: A contiene variabile provata B
    - A<->B bidirezionale: rischioso A punta B e B punta A (vanno sincronizzati)
- 1:N
    - classico caso, ricordare di usare List o Sets per N
- N:N
    - entrambe le classi hanno una collezione dell altra (studente ha piu corsi e un corso ha piu studenti)
- Associazione: es Utente partecipa a Evento, la data iscrizione non appartiene a nessuno dei due, _soluzione_: creare una terza classe "Partecipazione" che contiene dati extra sull evento

## Contratti ed elementi persistenti

i contratti corrispondono alle eccezioni `if + throw`

esempio se il metodo X richiede che il parametro A sia > 0 allora:
```java
if (A <= 0) { throw new NegativeAException(...) }
```

consiglio: farlo solo per interfacce pubbliche per non appesantire il sistema.

### Dagli Oggetti alle Tabelle

in pratica spiega gli orm.

solo piccolo memo per ereditarieta:

__Vertical Mapping__: quando per indicare "Veicolo" -> "Auto" | "Moto" fai 3 tabelle

Pro: è pulito
Contro: è lento, devi fare parecchie join.

__Horizontal Mapping__: unica tabella con tutte e tre le tpologie

Pro: molto veloce, tabella unica
Contro: molto sporco

## Gestione e controllo del mapping

Attenzione alla __desincronizzazione__!

Rischio: modifichi codice ma non UML, risultato: dopo 2 mesi le informazioni sono inconsistenti. Ottieni __Erosione Architetturale__.

Come evitare:
1. __Tracciabilità__: ogni modifica = nota che rimanda al modello
2. __Unicita strumento__: non usare software diversi per UML ma uno condiviso
3. __Code Review mirata__: quando controlli il codice di un collega non guardare solo se compila ma controlla se rispetta il disegno originale.

anche qui si ritorna ai ruoli, core, liasons...

## Comunicazione e Iterazione

Ciclo continuo:
1. disegni modello
2. scrivi codice
3. scrivendo codice ti accorgi di un difetto
4. torni indietro e ripeti.

Strumenti:
- __Plugin UML-IDE__: strumenti che collegano l editor di codice al tool UML diretto
- Pair modelling: tenersi sul video entrambe le schermate contemporaneamente

