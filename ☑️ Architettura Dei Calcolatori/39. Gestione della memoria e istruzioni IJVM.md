# 39. Gestione della memoria e istruzioni IJVM

gerarchie:

1. livello ISA (Instruction Set Architecture) -> codice assembly/binario
2. livello Microarchitettura -> hardware che interpreta ISA
3. livello logica digitale -> i circuiti

## Modello della memoria della IJVM

1. Porzione Costante (constant pool):
    - registro -> CPP constant pool pointer
    - funzione -> area di sola lettura per costanti
2. Area dei Metodi (Method Area):
    - registro -> PC program counter
    - funzione -> 
        * codice del programma
        * trattato come _array di byte_
        * punta alla prossima istruzione da leggere
3. Blocco Variabili Locali (Local Variables):
    - registro -> LV local variable pointer
    - funzione -> in breve contiene le variabili del metodo eseguito attualmente. LV punta alla base di questo spazio per il metodo corrente
4. Stack degli Operandi (Operand Stack):
    - registro -> SP stack pointer
    - funzione -> si trova sopra LV e serve per fare calcoli. SP punta alla parola in cima allo Stack

NOTA: tutto questo si trova in RAM e le _suddivisioni_ sono puramente __logiche__ non fisiche

## Gestione dello Stack nella IJVM

Ã¨ una macchina basata sullo stack (pila):

* come funziona lo stack:
    - puoi solo aggiungere (_PUSH_) o togliere (_POP_) dalla cima
    - ruolo di LV ed SP durante i metodi:
        - LV -> punta alla parola nella locazione piu bassa
        - SP -> punta alla parola nella locazione piu alta
    - ...

## Le istruzioni IJVM

OPCODE -> codice operativo, identificativo istruzione
Operando -> tendenzialmente 1 solo, alcune volte 2

tutte le istruzioni sono in binario ma per chiarezza le indichiamo a modi assembly:

### Categorie principali

1. Spostamento dati:
    - `BIPUSH byte`: spinge un byte sullo stack
    - `ILOAD varnum`: copia una variabile locale da LV e la copia in cima allo stack
    - `LDC_W index`: carica una costante dalla porzione costante
2. Salvataggio dati:
    - `ISTORE varnum`: prende il valore in cima allo stack e lo salva in una variabile locale
3. Matematica e logica:
    - `IADD`, `ISUB`: somma e sottrazione
    - `IAND`, `IOR`: ...
    - `IINC`: incrementa variabile locale tipo i++
4. Controllo di flusso (salti):
    - `INVOKEVIRTUAL`: chiama altro metodo
    - `IRETURN`: ritorna dal metodo
    - `POP`, `DUP`, `SWAP`: manipolano la cima dello stack SP e indicano
        - rimuovi
        - duplica
        - scambia
    