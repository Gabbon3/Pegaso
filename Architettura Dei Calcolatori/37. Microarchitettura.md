# 37. Microarchitettura

il livello microarchitettura si pone sotto il livello ISA (Instruction Set Architecture)

- ruolo -> implementare le istruzioni che controllano fisicamente l hardware come ADD, MOVE
- IJVM -> modello semplificato che esegue solo istruzioni su interi
- Microprogrammazione -> le istruzioni complesse come quelle della JVM vengono poi tradotte in una serie di istruzioni elementari da un microprogramma situato nella ROM

## Fetch Decode Execute

- fetch -> recupera la prossima istruzione in memoria (presente nel registro PC - Program Counter)
- decode -> capisce che tipo di istruzione si tratta guardando il codice operativo, l'_opcode_
- execute -> attiva i segnali elettrici ed esegue l operazione

## Data Path

percorso fisico dove scorrono i dati per essere elaborati
è formato da:
- registri -> 
    - PC (program counter)
    - MDR (memory data register) 
    - MAR (memory address register)
    - MBR (memory buffer register)
    - SP (stack pointer)
- BUS B -> il bus dedicato che collega registri e ALU
- ALU -> prende 2 input:
    - A: viene dal registro H (Holding register)
    - B: viene dal BUS B
- Shifter -> posto subito dopo la ALU
- BUS C -> bus che collega il risultato dell ALU o Shifter ai registri.

La _temporizzazione_ è fondamentale, tutto avviene in un ciclo di clock diviso in 4 fasi esplicite:
1. segnali di controllo, ce ne sono __29__ divisi in __5__ gruppi
    - __abilitazione scrittura registri__ _9 segnali_ -> chi salva il dato
    - __abilitazione lettura registri__ _9 segnali_ -> chi mette il dato sul bus
    - __funzioni ALU__ _6 segnali_ -> cosa deve fare l ALU
    - __operazioni shifter__ _2 segnali_ -> spostare i bit a destra, sinistra o nulla
    - __memoria e I/O__ _3 segnali_ -> leggi/scrivi in RAM, fetch
2. ALU e Shifter
3. output sul bus C
4. scrittura registri

## Operazioni di Memoria

La CPU per comunicare con la RAM utilizza 2 porte:
1. porta _dati_ (32 bit):
    - usa MAR per dire dove leggere / scrivere
    - usa MDR per contenere il dato letto da scrivere
2. porta _istruzioni_ (8 bit):
    - usa PC per indirizzo
    - usa MBR per leggere il byte dell istruzione

