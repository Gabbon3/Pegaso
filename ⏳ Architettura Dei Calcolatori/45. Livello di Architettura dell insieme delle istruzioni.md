# 45. Livello di Architettura dell insieme delle istruzioni

## 1. Livello ISA

il livello ISA è l'interfaccia fondamentale:

- Posizione -> si trova tra hardware (microarchitettura) e il software (sistema operativo e compilatori)
- Funzione -> definisce cosa la macchina sa fare (le istruzioni), quali registri sono visibili e come funziona la memoria.
- Astrazione -> al livello ISA non interessa come la CPU esegue i calcoli (mic1 mic2 o schiavi). Ci importa solo che esista l istruzione _ADD_.
    - Questo permette di cambiare l hardware sottostante senza dover riscrivere tutti i programmi. Parliamo quindi del principio della __retrocompatibilità__.

Esistono quindi due modalita di esecuzione:
1. __Kernel Mode__ -> super poteri, puo eseguire tutte le istruzioni e accedere a tutto l hardware (usato dall os)
2. __User Mode__ -> limitata. Non puo toccare direttamente periferiche o cache (usato da programmi come word o chrome).

## 2. Modelli di memoria

Come vede la memoria il programmatore ISA?
- __Celle o Parole__ -> la memoria è vista come una sequenza di byte. Spesso si lavora a multipli di 4 / 8 byte.
- __Concetto di allineamento__ -> la memoria funziona meglio se accedi ai dati in maniera ordinata:
    - se leggi una parola da 8 byte, dovresti leggera a indirizzi multipli di 8 (0, 8, 16...)
    - se provi a leggerla da un indirizzo storto (es 12) il processore fatica molto.
- __Sicurezza__ -> alcune architetture separano lo spazio diviso in _Istruzioni_ e _Dati_.
    - vantaggio: se il programma impazzisce non puo sovrascrivere il proprio codice, è usato anche come metodo di prevenzione dei virus

## 3. I Registri (dal punto di vista del programmatore)

- __registri nascosti__ -> registri come MAR, MDR, H sono segreti e nascosti dalla microarchitettura. Il programmatore isa non sa nemmeno che esistono.
- __registri visibili__ -> il programmatore vede ed utilizza:
    - _program counter_ PC e _stack pointer_ SP
    - Registri General purpose: R1, R2, EAX... usati per le variabili locali e i calcoli,

Il __Registro PSW__ (Program Status Word) questo è fondamentale ed è il famoso registro dei FLAG. Contiene i bit che indicano lo status dell ultima operazione sulla ALU:
- N negative risultato < 0
- Z zero -> risultato = 0
- V overflow -> il risultato è troppo grande per stare nel registro
- C carry -> riporto

